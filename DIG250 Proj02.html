<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dream Machine Synth 2.0</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.5/Tone.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
      color: #fff;
      text-align: center;
      padding: 2em;
    }

    h1 {
      color: #87CEFA;
      margin-bottom: 0.2em;
    }

    .controls {
      margin-top: 1.5em;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75em;
    }

    label {
      display: block;
      margin: 0.25em;
    }

    input[type="range"] {
      width: 300px;
      accent-color: #1e90ff;
    }

    button {
      background: #1e90ff;
      color: white;
      border: none;
      padding: 0.75em 1.5em;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: 0.2s;
    }

    button:hover {
      background: #63b3ff;
      transform: scale(1.05);
    }

    .pad {
      margin: 2em auto;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1em;
      max-width: 600px;
    }

    .note-btn {
      background: linear-gradient(145deg, #1e90ff, #63b3ff);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 1.2em 2em;
      font-size: 1.1em;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .note-btn:hover {
      background: linear-gradient(145deg, #63b3ff, #87CEFA);
      transform: translateY(-3px);
    }

    .note-btn:active {
      transform: scale(0.95);
      background: #1e90ff;
    }

    footer {
      margin-top: 2em;
      opacity: 0.8;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>Dream Machine</h1>
  <p>Play with your <b>keyboard (A‚ÄìK)</b> or click the note pads below!</p>

  <div class="pad">
    <button class="note-btn" data-note="C4">C</button>
    <button class="note-btn" data-note="D4">D</button>
    <button class="note-btn" data-note="E4">E</button>
    <button class="note-btn" data-note="F4">F</button>
    <button class="note-btn" data-note="G4">G</button>
    <button class="note-btn" data-note="A4">A</button>
    <button class="note-btn" data-note="B4">B</button>
    <button class="note-btn" data-note="C5">C5</button>
  </div>

  <div class="controls">
    <label>üéõÔ∏è Chorus Depth <input id="chorusDepth" type="range" min="0" max="1" step="0.05" value="0.4"></label>
    <label>üåä LFO Rate <input id="lfoRate" type="range" min="0.1" max="20" step="0.1" value="4"></label>
  </div>

  <footer>Built with Tone.js ‚Äî Roman DeMarco | Midterm Project</footer>

  <script>
    // --- Synth & Effects Setup ---
    const synth = new Tone.FMSynth({
      harmonicity: 2.5,
      modulationIndex: 10,
      oscillator: { type: "sine" },
      modulation: { type: "triangle" },
      envelope: { attack: 0.05, decay: 0.3, sustain: 0.6, release: 1 },
      modulationEnvelope: { attack: 0.3, decay: 0.2, sustain: 1, release: 1 }
    });

    const chorus = new Tone.Chorus(4, 2.5, 0.4).start();
    const reverb = new Tone.Reverb({ decay: 3, wet: 0.4 });
    const gain = new Tone.Gain(0.4);

    synth.chain(chorus, reverb, gain, Tone.Destination);

    // --- LFO Modulation (vibrato-like effect) ---
    const lfo = new Tone.LFO(4, -20, 20).start();
    lfo.connect(synth.detune);

    // --- Key Mapping ---
    const keyMap = {
      'a': 'C4', 's': 'D4', 'd': 'E4', 'f': 'F4',
      'g': 'G4', 'h': 'A4', 'j': 'B4', 'k': 'C5'
    };

    document.addEventListener("keydown", e => {
      if (keyMap[e.key]) synth.triggerAttack(keyMap[e.key]);
    });
    document.addEventListener("keyup", e => {
      if (keyMap[e.key]) synth.triggerRelease();
    });

    // --- Clickable Pads ---
    document.querySelectorAll('.note-btn').forEach(btn => {
      btn.addEventListener('mousedown', () => synth.triggerAttack(btn.dataset.note));
      btn.addEventListener('mouseup', () => synth.triggerRelease());
      btn.addEventListener('mouseleave', () => synth.triggerRelease());
    });

    // --- GUI Controls ---
    const chorusDepth = document.getElementById("chorusDepth");
    const lfoRate = document.getElementById("lfoRate");
    chorusDepth.oninput = () => chorus.depth = parseFloat(chorusDepth.value);
    lfoRate.oninput = () => lfo.frequency.value = parseFloat(lfoRate.value);
  </script>
</body>
</html>
